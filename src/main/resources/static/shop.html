<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop - Scrollable List with Filters</title>
    <style>
        /* Подключение шрифта Nunito-Black */
        @font-face {
            font-family: 'Nunito-Black';
            src: url('path/to/Nunito-Black.ttf') format('truetype'); /* Укажите путь к файлу шрифта */
        }

        body {
            font-family: 'Nunito-Black', Arial, sans-serif; /* Применение шрифта */
            margin: 0;
            padding: 0;
            background-image: url('/static/fffond.jpg');  /* Используем фон "fffon" */
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            height: 100vh;
        }

        /* Навигация */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(51, 51, 51, 0.8);  /* Полупрозрачный фон */
            color: white;
            padding: 15px;
            display: flex;
            align-items: center;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        /* Делаем "MyApp" ссылкой на shop.html */
        .navbar .logo a {
            font-size: 20px;
            font-weight: bold;
            color: white;
            text-decoration: none;
            margin-left: 20px;
            transition: 0.3s;
        }

        .navbar .logo a:hover {
            color: #ffcc00;
        }

        /* Стили для кнопок в навигации */
        .navbar .nav-links {
            display: flex;
            margin-left: 20px; /* Расстояние от MyApp */
        }

        .navbar .nav-links a {
            color: white;
            text-decoration: none;
            margin-left: 20px;
            font-size: 16px;
            transition: 0.3s;
        }

        .navbar .nav-links a:hover {
            color: #ffcc00;
        }

        /* Боковая панель фильтров */
        .filter-container {
            position: fixed;
            top: 53px; /* Начинаем сразу под навигацией */
            left: 0;
            width: 250px;
            background-color: rgba(51, 51, 51, 0.8);
            padding: 20px;
            color: white;
            height: calc(100vh - 80px); /* Высота на всю оставшуюся область экрана */
            overflow-y: auto;
            box-shadow: 2px 0px 5px rgba(0, 0, 0, 0.2);
        }

        .filter-container h3 {
            margin-bottom: 20px;
            font-size: 18px;
        }

        .filter-container select {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #fff;
            color: #333;
        }

        /* Контейнер для поиска */
        .search-container {
            margin-left: 300px; /* Чтобы контент не перекрывал фильтры */
            margin-top: 50px; /* Сдвигаем вниз, чтобы не накладывался на навигацию */
            width: 1575px; /* Заполнение ширины после фильтров */
            padding-bottom: 2px;
            padding-left: 10px
            background: rgba(255, 255, 255, 0.9);  /* Легкий фон для раздела поиска */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .search-container input {
            width: 1000px;
            max-width: 100%; /* Заполнение всей ширины экрана */
            padding: 16px;
            margin: 10px 0;
            margin-left: 20px
            font-size: 18px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #fff;
            color: #333;
        }

        /* Контейнер с товарами */
        .product-list-container {
            margin-left: 280px; /* Чтобы контент не перекрывал фильтры */
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px; /* Расстояние от контейнера с поиском */
            width: calc(100% - 250px - 20px); /* Ширина на оставшуюся часть экрана */
            height: calc(100vh - 120px); /* Высота на оставшуюся часть экрана (с учетом поиска) */
            overflow-y: auto;
        }

        .container {
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);  /* Прозрачный фон для списка */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            border-radius: 10px;
            padding: 10px;
            display: flex;
            flex-wrap: wrap; /* Чтобы элементы растягивались */
            justify-content: flex-start; /* Выравнивание элементов по левому краю */
            box-sizing: border-box;
        }

        .item {
            background: #e3e3e3;
            margin: 10px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-size: 18px;
            flex: 1 1 200px; /* Элементы будут занимать 200px, но могут расширяться */
            box-sizing: border-box;
        }

        .loader {
            text-align: center;
            font-size: 16px;
            padding: 10px;
            display: none;
        }
    </style>
</head>
<body>

<!-- Навигация -->
<div class="navbar">
    <div class="logo"><a href="shop.html">MyApp</a></div>
    <div class="nav-links">
        <a href="#">Profile</a>
        <a href="#">Logout</a>
    </div>
</div>

<!-- Боковая панель фильтров -->
<div class="filter-container">
    <h3>Filter Products</h3>
    <select id="exterior-filter">
        <option value="">All Exteriors</option>
        <option value="Factory New">Factory New</option>
        <option value="Minimal Wear">Minimal Wear</option>
        <option value="Field-Tested">Field-Tested</option>
        <option value="Well-Worn">Well-Worn</option>
        <option value="Battle-Scarred">Battle-Scarred</option>
    </select>
    <select>
        <option value="all">All Categories</option>
        <option value="electronics">Electronics</option>
        <option value="clothing">Clothing</option>
        <option value="accessories">Accessories</option>
    </select>
    <select>
        <option value="all">All Brands</option>
        <option value="brand1">Brand 1</option>
        <option value="brand2">Brand 2</option>
        <option value="brand3">Brand 3</option>
    </select>
    <select>
        <option value="all">Price Range</option>
        <option value="low">Low</option>
        <option value="medium">Medium</option>
        <option value="high">High</option>
    </select>
    <select>
        <option value="all">Rating</option>
        <option value="1">1 Star</option>
        <option value="2">2 Stars</option>
        <option value="3">3 Stars</option>
        <option value="4">4 Stars</option>
        <option value="5">5 Stars</option>
    </select>
</div>

<!-- Контейнер для поиска -->
<div class="search-container">
    <input type="text" id="search" placeholder="Search items..." />
</div>

<!-- Контейнер для списка товаров -->
<div class="product-list-container">
    <!-- Список товаров -->
    <div class="container" id="list-container"></div>
    <div class="loader" id="loader">Loading...</div>
</div>

<script>
    const container = document.getElementById("list-container");
    const loader = document.getElementById("loader");
    const searchInput = document.getElementById("search");

    let start = 0;
    const count = 500; // Количество элементов на запрос

    // Функция для подгрузки скинов
    async function fetchItems() {
        loader.style.display = "block"; // показываем индикатор загрузки
        try {
            const response = await fetch(`http://localhost:3000/api/market?start=${start}&count=${count}`);
            const data = await response.json();

            if (data && Array.isArray(data.results)) {
                data.results.forEach(item => {
                    const image = `https://community.cloudflare.steamstatic.com/economy/image/${item.asset_description.icon_url}`;
                    const title = item.name || "Unknown Item";
                    const exterior = item.asset_description.type || "Unknown Type";
                    const cost = item.sell_price_text || "N/A";

                    // Проверка фильтров
                    const exteriorFilter = document.getElementById("exterior-filter").value;
                    const searchFilter = searchInput.value.toLowerCase();

                    if ((exteriorFilter === "" || exteriorFilter === exterior) && title.toLowerCase().includes(searchFilter)) {
                        const itemElement = document.createElement("div");
                        itemElement.classList.add("item");

                        itemElement.innerHTML = `
                            <img src="${image}" alt="${title}" style="max-width: 100px; max-height: 100px;">
                            <div>${title}</div>
                            <div>Exterior: ${exterior}</div>
                            <div>Price: ${cost}</div>
                        `;
                        container.appendChild(itemElement);
                    }
                });
            }
        } catch (error) {
            console.error('Error fetching data:', error);
        } finally {
            loader.style.display = "none"; // скрыть индикатор загрузки
        }
    }

    function handleScroll() {
        if (container.scrollTop + container.clientHeight >= container.scrollHeight - 20) {
            if (!loading) {
                loading = true;
                loader.style.display = "block";
                setTimeout(() => {
                    start += count;
                    fetchItems();
                    loading = false;
                }, 1000);
            }
        }
    }

    function handleSearch() {
        const searchText = searchInput.value.toLowerCase();
        const items = container.getElementsByClassName('item');

        Array.from(items).forEach(item => {
            const itemText = item.textContent.toLowerCase();
            if (itemText.includes(searchText)) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    }

    // Загрузка товаров при старте
    fetchItems();
    container.addEventListener("scroll", handleScroll);
    searchInput.addEventListener("input", handleSearch); // Логика для поиска

</script>

</body>
</html>
